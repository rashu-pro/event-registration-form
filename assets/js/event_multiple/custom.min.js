/**
 * Created by rashu on 10/23/2022.
 */
let rowToDelete,J=Payment.J,creditCardField=$(".cc-number"),creditCardHolder=$(".cc-number-holder"),creditCardImageHolder=$(".cc-card-identity"),pageLoader=$(".loader-div"),bannerHeight=$(".main-banner").height(),ticketRowSelector=$(".form-body .form-row-ticket-individual"),uniqueId=(new Date).getUTCMilliseconds(),textMask=$(".mask-text"),phoneNumberMask=$(".phone-number-mask"),zipcodeMask=$(".mask-zipcode"),countryField=$(".country"),countrySelector=$(".country-selector"),stateFieldGroup=$(".state-field-group"),statesCanadaJson={Alberta:"Alberta","British Columbia":"British Columbia",Manitoba:"Manitoba","New Brunswick":"New Brunswick","Newfoundland and Labrador":"Newfoundland and Labrador","Northwest Territories":"Northwest Territories","Nova Scotia":"Nova Scotia",Nunavut:"Nunavut",Ontario:"Ontario","Prince Edward Island":"Prince Edward Island",Quebec:"Quebec",Saskatchewan:"Saskatchewan",Yukon:"Yukon"},radioHolder=$(".contact-information-inner.contact-information-single .contact-information-grouped-wrapper .checkbox-holder"),errorMessage="The field is required",ticketHtmlCloned="",termsConditionsSelector=$("#tc-2"),cartItemHolder=$(".ticket-summary-table tbody"),cartItemRows=$(".ticket-summary-table .ticket-price-row"),priceNoteWrapper=$(".price-note-wrapper"),paymentInfoForm=$("#payment-information"),btnAddAnother=$(".btn-add-another-js");const statesJson={USA:{Alabama:"Alabama",Alaska:"Alaska",Arizona:"Arizona",Arkansas:"Arkansas",California:"California",Colorado:"Colorado",Connecticut:"Connecticut",Delaware:"Delaware",Florida:"Florida",Georgia:"Georgia",Hawaii:"Hawaii",Idaho:"Idaho",Illinois:"Illinois",Indiana:"Indiana",Iowa:"Iowa",Kansas:"Kansas",Kentucky:"Kentucky",Louisiana:"Louisiana",Maine:"Maine",Maryland:"Maryland",Massachusetts:"Massachusetts",Michigan:"Michigan",Minnesota:"Minnesota",Mississippi:"Mississippi",Missouri:"Missouri",Montana:"Montana",Nebraska:"Nebraska",Nevada:"Nevada",NewHampshire:"NewHampshire",NewJersey:"NewJersey",NewMexico:"NewMexico",NewYork:"NewYork",NorthCarolina:"NorthCarolina",NorthDakota:"NorthDakota",Ohio:"Ohio",Oklahoma:"Oklahoma",Oregon:"Oregon",Pennsylvania:"Pennsylvania",RhodeIsland:"RhodeIsland",SouthCarolina:"SouthCarolina",SouthDakota:"SouthDakota",Tennessee:"Tennessee",Texas:"Texas",Utah:"Utah",Vermont:"Vermont",Virginia:"Virginia",Washington:"Washington",WestVirginia:"WestVirginia",Wisconsin:"Wisconsin",Wyoming:"Wyoming",zUnknown:"zUnknown"},Canada:{Alberta:"Alberta","British Columbia":"British Columbia",Manitoba:"Manitoba","New Brunswick":"New Brunswick","Newfoundland and Labrador":"Newfoundland and Labrador","Northwest Territories":"Northwest Territories","Nova Scotia":"Nova Scotia",Nunavut:"Nunavut",Ontario:"Ontario","Prince Edward Island":"Prince Edward Island",Quebec:"Quebec",Saskatchewan:"Saskatchewan",Yukon:"Yukon"}};function fixHeight(){let e="calc(100vh - "+(parseFloat($(".header").css("height"))+parseFloat($(".footer").css("height"))+parseFloat($(".main-wrapper").css("margin-top"))+parseFloat($(".main-wrapper").css("margin-bottom")))+"px)";$(".main-wrapper").css("min-height",e)}function isEmailValid(e){return/^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i.test(e)}function isZipCodeValid(e){return/(^\d{5}$)|(^\d{5}-\d{4}$)/.test(e)}function isNameValid(e){return/[-a-zA-Z' ]{6,26}/g.test(e)}function singleValidation(e,t,a,o,r,n){let i={formControl:e,formGroup:t,invalidClassName:a,validClassName:o,errorMessageClassName:r,errorMessage:"The field is required"};""!==e.val()?(e.hasClass("validation-text")&&(""!==e.val()?validationSuccess(i):validationFailed(i)),e.hasClass("validation-number")&&(e.data("length-min")&&(isNumber(e.val())&&e.val().length>=e.data("length-min")?validationSuccess(i):validationFailed(i)),e.data("length-max")&&(isNumber(e.val())&&e.val().length<e.data("length-max")?validationSuccess(i):validationFailed(i)),e.data("length-min")&&e.data("length-max")&&(isNumber(e.val())&&e.val().length>=e.data("length-min")&&e.val().length<e.data("length-max")?validationSuccess(i):validationFailed(i))),"SELECT"===e.prop("tagName")&&(""!==e.val()?validationSuccess(i):validationFailed(i)),e.hasClass("validation-email")&&(i.errorMessage="Invalid Email Address!",isEmailValid(e.val())?validationSuccess(i):validationFailed(i)),e.hasClass("validation-cc-number")&&(i.errorMessage="Invalid card number!",cardValidation()?validationSuccess(i):validationFailed(i))):validationFailed(i)}function cardValidation(){let e=document.querySelector(".cc-number"),t=Payment.fns.cardType(J.val(e));if(t)return creditCardField.addClass(t),creditCardImageHolder.html("<img src='assets/images/"+t+".png'>"),Payment.fns.validateCardNumber(J.val(e));creditCardImageHolder.html("<img src='assets/images/unknown.png'>")}function isNumber(e){return/^\d+$/.test(e)}function validationSuccess(e){e.formControl.removeClass(e.invalidClassName),e.formControl.removeClass("invalid"),e.formControl.addClass("valid"),e.formGroup.addClass(e.validClassName),e.formGroup.find("."+e.errorMessageClassName).remove()}function validationFailed(e){e.formGroup.removeClass(e.validClassName),e.formControl.addClass(e.invalidClassName),e.formControl.removeClass("valid"),e.formControl.addClass("invalid"),notifyError(e)}function notifyError(e){e.formGroup.find("."+e.errorMessageClassName).remove(),e.formGroup.append('<p class="'+e.errorMessageClassName+' text-danger">'+e.errorMessage+"</p>")}function makeCartItemReadyToAppend(e,t,a,o,r){e?(e.addClass("ticket-"+a+"-"+t),e.attr("data-row",t),e.attr("data-order",t),e.find(".tr-ticket-text").text(o),e.find(".amount").text(r)):console.log("cart item has not been created!")}function addItemIntoCart(e,t,a,o){t?(e.find(".ticket-"+o+"-"+a).remove(),e.append(t)):console.log("cart item has not been created!")}function elementOrder(e,t){e.sort((function(e,t){return $(e).data("order")-$(t).data("order")})),t.html(e)}function cartItemManipulation(e,t,a,o,r,n,i){if(!e)return o.find(".ticket-"+t+"-"+a).remove(),calculateTotal(),void elementOrder($(".ticket-summary-table tbody tr"),o);makeCartItemReadyToAppend(r,a,t,n,i),addItemIntoCart(o,r,a,t),calculateTotal(),elementOrder($(".ticket-summary-table tbody tr"),o)}function calculateSubTotal(e){let t=0;return $(e).each((function(e,a){console.log("row price:",$(a).find(".amount").text()),t+=parseInt($(a).find(".amount").text())})),t}function calculateTotal(){let e=calculateSubTotal(".ticket-summary-table .ticket-price-row"),t=$(".ticket-summary-table .ticket-price-row").length;$(".ticket-summary-table .total-price .amount").html(e),calculateGrandTotal(e),priceNoteWrapper.find(".ticket-count").html(t),priceNoteWrapper.find(".total-price").html(e),t?priceNoteWrapper.addClass("active"):priceNoteWrapper.removeClass("active")}function grandTotal(e){console.log("subtotal",e);let t=parseInt(e);return $(".ticket-summary-table .price-row-extra").each((function(e,a){console.log(parseInt($(a).find(".amount").text())),"plus"===$(a).data("method")&&(t+=parseInt($(a).find(".amount").text())),"minus"===$(a).data("method")&&(t-=parseInt($(a).find(".amount").text()))})),console.log("Grand total in grandTotal(): ",t),t}function calculateGrandTotal(e){let t=grandTotal(e);updateTotalInDOM(e,t),isPayment(t,paymentInfoForm)}function updateTotalInDOM(e,t){$("#sub-total-price").val(e),$("#total-price").val(t),$(".ticket-summary-table .grand-total-price .amount").html(t)}function isPayment(e,t){e<=0?t.hide():t.show()}function removeTicket(e){$(".form-row-ticket-individual[data-row="+e+"]").remove()}function removeCartItem(e){$(".ticket-price-row[data-row="+e+"]").remove(),calculateTotal(),$(".btn-apply-voucher-js").trigger("click"),elementOrder($(".ticket-summary-table tbody tr"),cartItemHolder)}function ticketSerialNumber(e){e.each((function(e,t){$(t).find(".ticket-row").html(e+1)}))}function deleteRow(e){pageLoader.addClass("active"),updateTicketQuantity(e),setTimeout((function(){removeTicket(e),removeCartItem(e),ticketSerialNumber(ticketRowSelector),console.log(ticketRowSelector.length),1==ticketRowSelector.length&&$(".form-row-ticket-individual").addClass("first-row"),ticketRowSelector.last().removeClass("edited"),ticketRowSelector.last().addClass("active"),pageLoader.removeClass("active")}),600)}function countryFiller(e,t){for(let a in e)t.append(`<option value="${a}">${a}</option>`)}function stateFiller(e,t,a,o){if(""===t.val())return console.log("no country selected!"),void a.html("<input type='text' class='form-control state' name='State' id='state'>");a.html("<select class='form-control state' name='State' id='state'></select>"),a.find("select").append("<option value=''>--Select a State--</option>");for(let t in o)e.find(a).find("select").append(`<option value="${t}">${t}</option>`)}function radioBoxIdGenerating(e){let t=(Math.random()+1).toString(36).substring(4,7);e.first().find("input").attr("id",t),e.first().find("label").attr("for",t),e.first().find("input").prop("checked",!0);let a=(Math.random()+1).toString(36).substring(4,7);e.last().find("input").attr("id",a),e.last().find("label").attr("for",a)}function updateTicketQuantity(e){$("#ticket-quantity").val(e)}fixHeight(),countrySelector.length>0&&(countryFiller(statesJson,countrySelector),stateFiller(countrySelector.closest(".form-row"),countrySelector,countrySelector.closest(".form-row").find(".state-holder"),statesJson[countrySelector.val()])),$(".cc-number").length,$(".ticket-summary-table").length>0&&$(".ticket-summary-table").closest(".sidebar-block").addClass("sidebar-block-ticket-summary"),$(document).on("focus",".form-body",(function(e){})),$(document).on("click",".btn-event-register",(function(e){e.preventDefault();let t=$(".main-form");if(t.find(".form-group.required-group").each((function(e,t){singleValidation($(t).find(".form-control"),$(t),"field-invalid","field-validated","error-message",errorMessage)})),!(t.find(".form-group .form-control.invalid").length>0))return termsConditionsSelector.prop("checked")?void(t.find(".form-group .form-control.invalid").length<1&&registrationConfirmation()):(termsConditionsSelector.closest(".tc-wrapper").find(".tc-inner").css("border","2px solid #dc3545"),void setTimeout((function(){termsConditionsSelector.closest(".tc-wrapper").find(".tc-inner").css("border","1px solid #084298")}),300));t.find(".form-group .form-control.invalid").first().focus()})),$(document).on("click",".cc-number-holder .cc-card-identity",(function(e){$(this).parent().find("input").focus()})),$(document).on("click",".expand-coupon-js",(function(){$(this).closest(".voucher-block").toggleClass("active")})),$(document).on("click",".btn-add-another-js",(function(e){e.preventDefault();let t=$(this),a=t.closest("."+t.data("root"));a.find(".form-group.required-group").each((function(e,t){singleValidation($(t).find(".form-control"),$(t),"field-invalid","field-validated","error-message",errorMessage)})),a.find(".form-group .form-control.invalid").first().focus(),a.find(".form-group .form-control.invalid").length<1&&(pageLoader.addClass("active"),setTimeout((function(){a.removeClass("active").addClass("edited"),a.hasClass("cloneable")&&(ticketHtmlCloned=a.clone()),ticketHtmlCloned.addClass("active").removeClass("edited").removeClass("first-row"),ticketHtmlCloned.attr("data-row",parseInt(a.attr("data-row"))+1),ticketHtmlCloned.find(".form-control").removeClass("valid"),ticketHtmlCloned.find(".form-control").closest(".form-group").removeClass("field-validated"),ticketHtmlCloned.find(".form-control").val(""),ticketHtmlCloned.find(".form-group.phone-number-validator-wrapper").html($(".form-group-to-clone").html()),ticketHtmlCloned.find(".form-group.phone-number-validator-wrapper .form-control").addClass("phone-number-validator"),t.closest(".form-body").append(ticketHtmlCloned);let e=document.querySelectorAll(".phone-number-validator");e&&phoneNumberValidator(e,phoneNumberWrapperSelectorName,alertMessageSelectorName),pageLoader.removeClass("active"),window.scrollTo({top:bannerHeight,behavior:"smooth"})}),500))})),$(document).on("click",".btn-ticket-collapse",(function(e){e.preventDefault(),$(this).closest(".form-row-ticket-individual").toggleClass("active")})),$(document).on("click",".btn-delete-ticket-js",(function(e){e.preventDefault();let t=$(this).closest(".form-row-ticket-individual"),a=t.data("row");t.data("type");rowToDelete=a,$("#confirm-modal-delete .modal-confirm").attr("data-row",a),$("#confirm-modal-delete").modal("show")})),$(document).on("click",".btn-delete-row-confirm",(function(){let e=$(this);e.closest(".modal-confirm").data("row");e.closest(".modal-confirm").css("border","1px solid red"),deleteRow(rowToDelete),$("#confirm-modal-delete").modal("hide")})),$(document).on("change",".ticket-type-js",(function(e){e.preventDefault();let t=$(this),a=t.closest(".form-row-ticket-individual"),o=t.children(":selected").attr("data-text"),r=t.children(":selected").attr("data-price"),n=(t.children(":selected").attr("data-unitPrice"),a.data("row")),i=t.data("type"),l=$(".ticket-summary-row-table-to-clone tr").clone(),s=!0;if(""===t.val()&&(s=!1),cartItemManipulation(s,i,n,cartItemHolder,l,o,r),!t.data("dynamic"))return;let d=$(".contact-information-html .contact-information-grouped-single-copy").clone();t.closest(".form-row-ticket-individual").find(".contact-information-grouped-single").remove(),t.closest(".form-row-ticket-individual").find(".contact-information-grouped-wrapper").append(d),t.closest(".form-row-ticket-individual").find(".contact-information-grouped-wrapper .contact-information-grouped-single-copy").addClass("contact-information-grouped-single")})),$(document).on("change","#addon-ticket",(function(){let e=$(this),t=e.data("unitprice"),a=e.data("name")+" X "+e.val(),o=parseInt(t)*parseInt(e.val()),r=e.data("type"),n=$(".ticket-summary-row-table-to-clone tr").clone(),i=!0;0==e.val()&&(i=!1),cartItemManipulation(i,r,200,cartItemHolder,n,a,o)})),$(document).on("change",".country-selector",(function(e){let t=$(this),a=t.closest(".form-row"),o=a.find(".state-holder"),r=statesJson[t.val()];stateFiller(a,t,o,r)}));
